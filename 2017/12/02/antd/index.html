<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <meta name="google-site-verification" content="6jvcY_UrCpp1JLjXITf45ljboLU0NDGF16ZqomMt-ls">
  
  <title>antd随笔 | 个人笔记</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="antd https://ant.design/index-cn 环境本着学习的目的，最开始自己从零折腾，不过后来放弃了，学习从https://github.com/zuiidea/antd-admin开始 可以直接删除业务/页面代码，保留配置继续开发，后者体验网址http://antd-admin.zuiidea.com html5/es6+/react大量使用es6语法 简化的import/e">
<meta name="keywords" content="antd">
<meta property="og:type" content="article">
<meta property="og:title" content="antd随笔">
<meta property="og:url" content="http://blog.kimq.cn/2017/12/02/antd/index.html">
<meta property="og:site_name" content="个人笔记">
<meta property="og:description" content="antd https://ant.design/index-cn 环境本着学习的目的，最开始自己从零折腾，不过后来放弃了，学习从https://github.com/zuiidea/antd-admin开始 可以直接删除业务/页面代码，保留配置继续开发，后者体验网址http://antd-admin.zuiidea.com html5/es6+/react大量使用es6语法 简化的import/e">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2020-08-01T09:26:24.727Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="antd随笔">
<meta name="twitter:description" content="antd https://ant.design/index-cn 环境本着学习的目的，最开始自己从零折腾，不过后来放弃了，学习从https://github.com/zuiidea/antd-admin开始 可以直接删除业务/页面代码，保留配置继续开发，后者体验网址http://antd-admin.zuiidea.com html5/es6+/react大量使用es6语法 简化的import/e">
  
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" integrity="sha384-XdYbMnZ/QjLh6iI4ogqCTaIjrFk87ip+ekIjefZch0Y+PvJ8CDYtEs1ipDmPorQ+" crossorigin="anonymous">

  <link rel="stylesheet" href="/css/styles.css">
  

</head>
</html>
<body>
  <nav class="navbar navbar-inverse">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-menu-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="main-menu-navbar">
      <ul class="nav navbar-nav">
        
          <li><a class=""
                 href="/index.html">Home</a></li>
        
          <li><a class=""
                 href="/archives/">Archives</a></li>
        
          <li><a class=""
                 href="/atom.xml">Rss</a></li>
        
      </ul>

      <!--
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      -->
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>

  <div class="container">
    <div class="blog-header">
  <h1 class="blog-title">个人笔记</h1>
  
    <p class="lead blog-description">专注互联网</p>
  
</div>

    <div class="row">
        <div class="col-sm-9 blog-main">
          <article id="post-antd" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 class="article-title" itemprop="name">
      antd随笔
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/2017/12/02/antd/" class="article-date"><time datetime="2017-12-02T15:20:52.000Z" itemprop="datePublished">2017-12-02</time></a>
</div>

    
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/学习笔记/">学习笔记</a>
  </div>


  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p>antd <a href="https://ant.design/index-cn" target="_blank" rel="noopener">https://ant.design/index-cn</a></p>
<h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><p>本着学习的目的，最开始自己从零折腾，不过后来放弃了，学习从<a href="https://github.com/zuiidea/antd-admin" target="_blank" rel="noopener">https://github.com/zuiidea/antd-admin</a>开始</p>
<p>可以直接删除业务/页面代码，保留配置继续开发，后者体验网址<a href="http://antd-admin.zuiidea.com" target="_blank" rel="noopener">http://antd-admin.zuiidea.com</a></p>
<h1 id="html5-es6-react"><a href="#html5-es6-react" class="headerlink" title="html5/es6+/react"></a>html5/es6+/react</h1><p>大量使用es6语法</p>
<p>简化的import/export，以及<a href="https://segmentfault.com/q/1010000005762199" target="_blank" rel="noopener">大括号语法</a>，自动导出子模块（变量）<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;request, config&#125; <span class="keyword">from</span> <span class="string">'utils'</span></span><br><span class="line"><span class="keyword">const</span> &#123;api&#125; = config;</span><br></pre></td></tr></table></figure></p>
<p><a href="http://www.ruanyifeng.com/blog/2015/05/async.html" target="_blank" rel="noopener">异步函数</a>/<code>async</code><br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">loginCb</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(&#123;</span><br><span class="line">    url: api.userLoginCB,</span><br><span class="line">    method: <span class="string">'get'</span>,</span><br><span class="line">    data,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><a href="http://www.ruanyifeng.com/blog/2015/04/generator.html" target="_blank" rel="noopener">生成器函数</a>/<code>yield</code>/<code>*函数</code><br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">yield</span> put(&#123;</span><br><span class="line">  type: <span class="string">'querySuccess'</span>,</span><br><span class="line">  payload: &#123;</span><br><span class="line">    data: data,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">* query(&#123;</span><br><span class="line">          url,</span><br><span class="line">          payload,</span><br><span class="line">        &#125;, &#123;call, put&#125;) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;data&#125; = <span class="keyword">yield</span> call(url, payload);</span><br><span class="line">  <span class="keyword">yield</span> put(&#123;</span><br><span class="line">    type: <span class="string">'querySuccess'</span>,</span><br><span class="line">    payload: &#123;</span><br><span class="line">      data: data,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<p>箭头函数<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(<span class="function">(<span class="params">&#123; detail, loading &#125;</span>) =&gt;</span> (&#123; <span class="attr">state</span>:detail, loading &#125;))(Detail)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> handleOk = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  validateFields(<span class="function">(<span class="params">errors</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (errors) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> data = &#123;</span><br><span class="line">      ...item,</span><br><span class="line">      ...getFieldsValue(),</span><br><span class="line">    &#125;;</span><br><span class="line">    onOk(data)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 多重</span></span><br><span class="line"><span class="keyword">const</span> handleChange = <span class="function">(<span class="params">count</span>) =&gt;</span> <span class="function">(<span class="params">fileList</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="comment">// do sth</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>合并对象/…<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> data = &#123;</span><br><span class="line">  ...item,</span><br><span class="line">  ...getFieldsValue(),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>const/let声明变量/常亮</p>
<p>(不)等于 ===/!==</p>
<p><a href="https://www.cnblogs.com/zxyun/p/7019631.html" target="_blank" rel="noopener">map/filter</a></p>
<p>window.localStorage保存本地配置</p>
<h2 id="React"><a href="#React" class="headerlink" title="React"></a>React</h2><p>react组件有<a href="https://www.cnblogs.com/wonyun/p/5930333.html" target="_blank" rel="noopener">三种声明</a>方式</p>
<p>antd大量使用<code>函数式定义</code>的写法，这种写法是废代码不多，但是不支持状态和react事件</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; config &#125; <span class="keyword">from</span> <span class="string">'utils'</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">'./Footer.less'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Footer = <span class="function"><span class="params">()</span> =&gt;</span> (&lt;div className=&#123;styles.footer&#125;&gt;</span><br><span class="line">  &#123;config.footerText&#125;</span><br><span class="line">&lt;/div&gt;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Footer</span><br></pre></td></tr></table></figure>
<p>es5原生方式React.createClass定义的组件</p>
<p>es6形式的extends React.Component定义的组件</p>
<h1 id="跳转"><a href="#跳转" class="headerlink" title="跳转"></a>跳转</h1><p>跳转可以用history接口<a href="https://developer.mozilla.org/en-US/docs/Web/API/History_API" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Web/API/History_API</a></p>
<p>或者更高层的history库 <a href="https://github.com/ReactTraining/history" target="_blank" rel="noopener">https://github.com/ReactTraining/history</a></p>
<p>不过推荐dispatch一个routerRedux异步任务的方式</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">dispatch(routerRedux.push(&#123;</span><br><span class="line">  pathname: buildUrl(route.apartmentBatchPrice,&#123;<span class="attr">id</span>:record.id&#125;),</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure>
<h2 id="React-router的迁移问题"><a href="#React-router的迁移问题" class="headerlink" title="React router的迁移问题"></a>React router的迁移问题</h2><p>React router 2到4接口改变了很多，antd/dva版本上也有出现很多问题，参见<a href="https://github.com/gmfe/Think/issues/6" target="_blank" rel="noopener">https://github.com/gmfe/Think/issues/6</a></p>
<p>新版本不再有query成员，不过可以手动处理下<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> queryString = <span class="built_in">require</span>(<span class="string">'query-string'</span>);</span><br><span class="line">location.query = queryString.parse(location.search);</span><br></pre></td></tr></table></figure></p>
<h2 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h2><p>跳转时，一般使用url的query参数传递参数，不过若使用<a href="https://github.com/ReactTraining/history" target="_blank" rel="noopener">ReactTraining/history</a> 库，可以借助<code>location.state</code></p>
<ol>
<li>location.pathname - The path of the URL</li>
<li>location.search - The URL query string</li>
<li>location.hash - The URL hash fragment</li>
<li>location.state - Some extra state for this location that does not reside in the URL (supported in createBrowserHistory and createMemoryHistory)</li>
<li>location.key - A unique string representing this location (supported in createBrowserHistory and createMemoryHistory)</li>
</ol>
<blockquote>
<p>routerRedux.push的参数就是一个location对象</p>
</blockquote>
<h1 id="Model复用"><a href="#Model复用" class="headerlink" title="Model复用"></a><a href="https://github.com/dvajs/dva-model-extend" target="_blank" rel="noopener">Model复用</a></h1><p>借助dva提供的<code>modelExtend</code>，可以复用model的变量和方法，</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> modelExtend <span class="keyword">from</span> <span class="string">'dva-model-extend'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> model = &#123;</span><br><span class="line">  reducers: &#123;</span><br><span class="line">    updateState (state, &#123; payload &#125;) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        ...payload,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pageModel = modelExtend(model, &#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    list: [],</span><br><span class="line">    pagination: &#123;</span><br><span class="line">      showSizeChanger: <span class="literal">false</span>,</span><br><span class="line">      showQuickJumper: <span class="literal">false</span>,</span><br><span class="line">      showTotal: <span class="function"><span class="params">total</span> =&gt;</span> <span class="string">`共 <span class="subst">$&#123;total&#125;</span> 条记录`</span>,</span><br><span class="line">      current: <span class="number">1</span>,</span><br><span class="line">      total: <span class="number">0</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  reducers: &#123;</span><br><span class="line">    querySuccess (state, &#123; payload &#125;) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; list, pagination &#125; = payload</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        ...&#123;<span class="attr">list</span>:list&#125;,</span><br><span class="line">        pagination: &#123;</span><br><span class="line">          ...state.pagination,</span><br><span class="line">          ...pagination,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  model,</span><br><span class="line">  pageModel,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>和C++的继承有几分相似的是，modelExtend的继承可以继续继承，也可以多继承</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> pageModel = modelExtend(model, model2 &#123;</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="service优化"><a href="#service优化" class="headerlink" title="service优化"></a>service优化</h1><p>service定义了调用后端Api的接口，每个route的service结构都大同小异，考虑到常用的就CRUD，对于同一个后端，使用的http method/参数定义也相同，所以可以抽象以下。</p>
<p>下面的代码架设了create/query/detail/update/enable/disable/remove等常用方法的请求格式<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;request, config&#125; <span class="keyword">from</span> <span class="string">'utils'</span></span><br><span class="line"><span class="keyword">import</span> &#123;buildUrl&#125; <span class="keyword">from</span> <span class="string">'../utils/url'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createService</span>(<span class="params">keys</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> res = &#123;&#125;;</span><br><span class="line">  <span class="keyword">let</span> exclude = &#123;&#125;</span><br><span class="line">  <span class="keyword">if</span> (keys[<span class="string">"create"</span>]) &#123;</span><br><span class="line">    res[<span class="string">"create"</span>] =</span><br><span class="line">      <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">create</span>(<span class="params">data, param=null</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">          url: buildUrl(keys.create, param),</span><br><span class="line">          method: <span class="string">'post'</span>,</span><br><span class="line">          data,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    exclude[<span class="string">"create"</span>] = <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (keys[<span class="string">"query"</span>]) &#123;</span><br><span class="line">    res[<span class="string">"query"</span>] =</span><br><span class="line">      <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">query</span>(<span class="params">data, param=null</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">          url: buildUrl(keys.query, param),</span><br><span class="line">          method: <span class="string">'get'</span>,</span><br><span class="line">          data,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    exclude[<span class="string">"query"</span>] = <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (keys[<span class="string">"detail"</span>]) &#123;</span><br><span class="line">    res[<span class="string">"detail"</span>] =</span><br><span class="line">      <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">detail</span>(<span class="params">param = null</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">          url: buildUrl(keys.detail, param),</span><br><span class="line">          method: <span class="string">'get'</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    exclude[<span class="string">"detail"</span>] = <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (keys[<span class="string">"update"</span>]) &#123;</span><br><span class="line">    res[<span class="string">"update"</span>] =</span><br><span class="line">      <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params">data, param=null</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">          url: buildUrl(keys.update, param),</span><br><span class="line">          method: <span class="string">'put'</span>,</span><br><span class="line">          data: data,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    exclude[<span class="string">"update"</span>] = <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (keys[<span class="string">"enable"</span>]) &#123;</span><br><span class="line">    res[<span class="string">"enable"</span>] =</span><br><span class="line">      <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">enable</span>(<span class="params">param = null</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">          url: buildUrl(keys.enable, param),</span><br><span class="line">          method: <span class="string">'post'</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    exclude[<span class="string">"enable"</span>] = <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (keys[<span class="string">"disable"</span>]) &#123;</span><br><span class="line">    res[<span class="string">"disable"</span>] =</span><br><span class="line">      <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">disable</span>(<span class="params">param = null</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">          url: buildUrl(keys.disable, param),</span><br><span class="line">          method: <span class="string">'post'</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    exclude[<span class="string">"disable"</span>] = <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (keys[<span class="string">"remove"</span>]) &#123;</span><br><span class="line">    res[<span class="string">"remove"</span>] =</span><br><span class="line">      <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">remove</span>(<span class="params">param = null</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> request(&#123;</span><br><span class="line">          url: buildUrl(keys.remove, param),</span><br><span class="line">          method: <span class="string">'delete'</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    exclude[<span class="string">"remove"</span>] = <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> methods = &#123;</span><br><span class="line">    <span class="string">"post"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="string">"put"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="string">"get"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="string">"delete"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="string">"patch"</span>: <span class="literal">null</span>,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> keys) &#123;</span><br><span class="line">    <span class="keyword">if</span> (keys.hasOwnProperty(key))&#123;</span><br><span class="line">      <span class="comment">// 排除上面的通用方法</span></span><br><span class="line">      <span class="keyword">if</span>(key <span class="keyword">in</span> exclude) <span class="keyword">continue</span></span><br><span class="line">      <span class="comment">// 必须是对象</span></span><br><span class="line">      <span class="keyword">if</span>(<span class="keyword">typeof</span> keys[key] === <span class="string">'object'</span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> rt = keys[key]</span><br><span class="line">        <span class="comment">// 合法的方法</span></span><br><span class="line">        <span class="keyword">if</span>(!rt.method <span class="keyword">in</span> methods) &#123;</span><br><span class="line">          <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        res[key] =</span><br><span class="line">          <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">create</span>(<span class="params">data, param=null</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> request(&#123;</span><br><span class="line">              url: buildUrl(rt.url, param),</span><br><span class="line">              method: rt.method,</span><br><span class="line">              data,</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;request, config&#125; <span class="keyword">from</span> <span class="string">'utils'</span></span><br><span class="line"><span class="keyword">import</span> &#123;createService&#125; <span class="keyword">from</span> <span class="string">"./common"</span></span><br><span class="line"></span><br><span class="line">exports.services = createService(config.api.user);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">user: &#123;</span><br><span class="line">  <span class="string">"query"</span>: <span class="string">`<span class="subst">$&#123;APIV1&#125;</span>/users/`</span>,</span><br><span class="line">  <span class="string">"update"</span>: <span class="string">`<span class="subst">$&#123;APIV1&#125;</span>/users/:id`</span>,</span><br><span class="line">  <span class="string">"detail"</span>: <span class="string">`<span class="subst">$&#123;APIV1&#125;</span>/users/:id`</span>,</span><br><span class="line">  <span class="string">"enable"</span>: <span class="string">`<span class="subst">$&#123;APIV1&#125;</span>/users/:id/enable`</span>,</span><br><span class="line">  <span class="string">"disable"</span>: <span class="string">`<span class="subst">$&#123;APIV1&#125;</span>/users/:id/disable`</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>一些特殊的方法，则简单描述即可</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;request, config&#125; <span class="keyword">from</span> <span class="string">'utils'</span></span><br><span class="line"><span class="keyword">import</span> &#123;createService&#125; <span class="keyword">from</span> <span class="string">"./common"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> routes = config.api.price</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">typeof</span> routes[<span class="string">"generate"</span>] != <span class="string">'object'</span>)&#123;</span><br><span class="line">  routes[<span class="string">'generate'</span>] = &#123;</span><br><span class="line">    <span class="string">"method"</span>: <span class="string">"post"</span>,</span><br><span class="line">    <span class="string">"url"</span>: routes[<span class="string">'generate'</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.services = createService(routes);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">price: &#123;</span><br><span class="line">  <span class="string">"create"</span>: <span class="string">`<span class="subst">$&#123;APIV1&#125;</span>/:id/prices`</span>,</span><br><span class="line">  <span class="string">"update"</span>: <span class="string">`<span class="subst">$&#123;APIV1&#125;</span>/:id/prices`</span>,</span><br><span class="line">  <span class="string">"query"</span>: <span class="string">`<span class="subst">$&#123;APIV1&#125;</span>/:id/prices`</span>,</span><br><span class="line">  <span class="string">"generate"</span>: <span class="string">`<span class="subst">$&#123;APIV1&#125;</span>/:id/prices/generate`</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Url"><a href="#Url" class="headerlink" title="Url"></a>Url</h1><p>大量使用<a href="https://github.com/pillarjs/path-to-regexp" target="_blank" rel="noopener">path-to-regexp</a></p>
<p>有用到几种场景</p>
<p>判断是否是我们需要的url<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">setup(&#123;dispatch, history&#125;) &#123;</span><br><span class="line">  history.listen(<span class="function">(<span class="params">location</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> match = pathToRegexp(route.apartments).exec(location.pathname);</span><br><span class="line">    <span class="keyword">if</span> (match) &#123;</span><br><span class="line">      location.query = queryString.parse(location.search);</span><br><span class="line">      <span class="keyword">const</span> payload = location.query || &#123;<span class="attr">page</span>: <span class="number">1</span>, <span class="attr">count</span>: countPePage&#125;;</span><br><span class="line">      dispatch(&#123;</span><br><span class="line">        type: <span class="string">'query'</span>,</span><br><span class="line">        payload,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<p>构建url用于跳转，解析url中的参数<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pathToRegexp <span class="keyword">from</span> <span class="string">'path-to-regexp'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  buildUrl:<span class="function">(<span class="params">url, param</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(!param) <span class="keyword">return</span> url;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> toPath = pathToRegexp.compile(url);</span><br><span class="line">    <span class="keyword">return</span> toPath(param);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  parseUrl:<span class="function">(<span class="params">url,route</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> match = pathToRegexp(route).exec(url)</span><br><span class="line">    <span class="keyword">if</span>(!match) <span class="keyword">return</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> urlDatas = &#123;&#125;;</span><br><span class="line">    <span class="keyword">let</span> index = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">const</span> keys = pathToRegexp.parse(route)</span><br><span class="line">    keys.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(<span class="keyword">typeof</span> item !== <span class="string">'object'</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      urlDatas[item.name] = match[index]</span><br><span class="line">      index ++</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> urlDatas</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">yield</span> put(routerRedux.push(&#123;</span><br><span class="line">  pathname: buildUrl(route.storeDetailIndex,&#123;<span class="attr">id</span>:store.id,<span class="attr">tab</span>:route.storeDetailTab.rule&#125;),</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> urlDatas = parseUrl(location.pathname, current.route);</span><br><span class="line">pathArray.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(item === current || !item.route) <span class="keyword">return</span>;</span><br><span class="line">  item.route2 = buildUrl(item.route,urlDatas)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h1 id="dva-loading"><a href="#dva-loading" class="headerlink" title="dva-loading"></a><a href="https://github.com/dvajs/dva/tree/master/packages/dva-loading" target="_blank" rel="noopener">dva-loading</a></h1><p>通过绑定一个<a href="https://github.com/redux-saga/redux-saga" target="_blank" rel="noopener">redux-saga</a>异步请求来实现UI的<code>加载中</code>的效果</p>
<p>关于dva以及react全家桶的一些概念，参见<a href="https://github.com/dvajs/dva/blob/master/README_zh-CN.md" target="_blank" rel="noopener">https://github.com/dvajs/dva/blob/master/README_zh-CN.md</a></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> createLoading <span class="keyword">from</span> <span class="string">'dva-loading'</span></span><br><span class="line"><span class="comment">// 1. Initialize</span></span><br><span class="line"><span class="keyword">const</span> app = dva(&#123;</span><br><span class="line">  ...createLoading(&#123;</span><br><span class="line">    effects: <span class="literal">true</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(<span class="function">(<span class="params">&#123; detail, loading &#125;</span>) =&gt;</span> (&#123; <span class="attr">state</span>:detail, loading &#125;))(Detail)</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;Button type=<span class="string">"primary"</span> size=<span class="string">"large"</span> loading=&#123;loading.effects.login&#125;&gt;</span><br><span class="line">  登录</span><br><span class="line">&lt;<span class="regexp">/Button&gt;</span></span><br></pre></td></tr></table></figure>
<p>antd很多组件都集成了loading属性。例如<a href="https://ant.design/components/button-cn/#API" target="_blank" rel="noopener">button</a>，<a href="https://ant.design/components/table-cn/#Table" target="_blank" rel="noopener">Table</a></p>
<p>当页面不存在这些支持loading的控件，或者不合适使用时，antd-admin提供了一个全局的<a href="https://github.com/zuiidea/antd-admin/tree/master/src/components/Loader" target="_blank" rel="noopener">Loader</a>控件<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> LoginCB = <span class="function">(<span class="params">&#123;location, dispatch, loading&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;Loader fullScreen spinning=&#123;loading.effects[<span class="string">'login_cb/login'</span>]&#125; /&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure></p>
<h1 id="表单"><a href="#表单" class="headerlink" title="表单"></a><a href="https://ant.design/components/form-cn/" target="_blank" rel="noopener">表单</a></h1><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;Form.Item &#123;...props&#125;&gt;</span><br><span class="line">  &#123;children&#125;</span><br><span class="line">&lt;<span class="regexp">/Form.Item&gt;</span></span><br></pre></td></tr></table></figure>
<p>form基于<a href="https://github.com/react-component/form" target="_blank" rel="noopener">rc-form</a>，一些选项可以参考<a href="https://github.com/react-component/form#option-object" target="_blank" rel="noopener">https://github.com/react-component/form#option-object</a></p>
<p>经过 <code>getFieldDecorator</code> 包装的控件，表单控件会自动添加 <code>value</code>（或 <code>valuePropName</code> 指定的其他属性） <code>onChange</code>（或 trigger 指定的其他属性），数据同步将被 Form 接管，这会导致以下结果：</p>
<ol>
<li>你不再需要也不应该用 <code>onChange</code> 来做同步，但还是可以继续监听 onChange 等事件。</li>
<li>你不能用控件的 <code>value</code> <code>defaultValue</code> 等属性来设置表单域的值，默认值可以用 <code>getFieldDecorator</code> 里的 <code>initialValue</code>。</li>
<li>你不应该用 <code>setState</code>，可以使用 <code>this.props.form.setFieldsValue</code> 来动态改变表单值。</li>
</ol>
<h2 id="自定义控件适配"><a href="#自定义控件适配" class="headerlink" title="自定义控件适配"></a><a href="https://github.com/ant-design/ant-design/issues/5700" target="_blank" rel="noopener">自定义控件适配</a></h2><p>参考<a href="https://ant.design/components/form/#components-form-demo-customized-form-controls" target="_blank" rel="noopener">https://ant.design/components/form/#components-form-demo-customized-form-controls</a></p>
<p>关键两点</p>
<ol>
<li>初始值从<code>props.value</code>获取，这个值从<code>getFieldDecorator</code>的<code>initialValue</code>获取</li>
<li>当控件<code>value</code>值改变时，通过<code>props.onChange</code>获取到触发<code>getFieldDecorator</code>的回调，并触发之</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123;Select&#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;connect&#125; <span class="keyword">from</span> <span class="string">'dva'</span></span><br><span class="line"><span class="keyword">import</span> &#123;Icon&#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span>;</span><br><span class="line"><span class="keyword">const</span> &#123;Option&#125; = Select;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IDSelect</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> value = <span class="keyword">this</span>.props.value || [];</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      current_value: <span class="literal">undefined</span>,</span><br><span class="line">      list: [],</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentWillReceiveProps(nextProps) &#123;</span><br><span class="line">    <span class="comment">// Should be a controlled component.</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">'value'</span> <span class="keyword">in</span> nextProps) &#123;</span><br><span class="line">      <span class="comment">// ----- mark------</span></span><br><span class="line">      <span class="keyword">const</span> value = nextProps.value;</span><br><span class="line">      <span class="keyword">if</span>(value === <span class="literal">undefined</span>) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!value)&#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;<span class="attr">current_value</span>: <span class="literal">null</span>&#125;);</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;<span class="attr">current_value</span>:<span class="built_in">String</span>(value)&#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">'list'</span> <span class="keyword">in</span> nextProps) &#123;</span><br><span class="line">      <span class="keyword">const</span> list = nextProps.list;</span><br><span class="line">      <span class="keyword">if</span>(list === <span class="literal">undefined</span>) <span class="keyword">return</span></span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;list&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> handleChange = <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;<span class="attr">current_value</span>:value&#125;);</span><br><span class="line">      <span class="comment">// ----- mark------</span></span><br><span class="line">      <span class="keyword">const</span> onChange = <span class="keyword">this</span>.props.onChange;</span><br><span class="line">      <span class="keyword">if</span> (onChange) &#123;</span><br><span class="line">        onChange(<span class="built_in">parseInt</span>(value));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123;list,value,...props&#125; = <span class="keyword">this</span>.props</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;span&gt;</span><br><span class="line">      &#123;<span class="keyword">this</span>.state.list.length &gt; <span class="number">0</span> &amp;&amp; &lt;Select</span><br><span class="line">        &#123;...props&#125;</span><br><span class="line">        defaultValue=&#123;this.state.current_value&#125;</span><br><span class="line">        onChange=&#123;handleChange&#125;</span><br><span class="line">        &gt;</span><br><span class="line">          &#123;this.state.list.map(function (object, i) &#123;</span><br><span class="line">            return &lt;Option value=&#123;String(object.id)&#125; key=&#123;i&#125;&gt;&#123;object.name&#125;&lt;/Option&gt;;</span><br><span class="line">          &#125;)&#125;</span><br><span class="line">        &lt;/Select&gt;&#125;</span><br><span class="line">      &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">IDSelect.propTypes = &#123;</span></span><br><span class="line"><span class="regexp">  value: PropTypes.number,</span></span><br><span class="line"><span class="regexp">  list: PropTypes.arrayOf(PropTypes.object),</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">module.exports = &#123;</span></span><br><span class="line"><span class="regexp">  IDSelect,</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;FormItem&gt;</span><br><span class="line">  &#123;getFieldDecorator(<span class="string">'user_id'</span>, &#123;</span><br><span class="line">    initialValue: state.editType === <span class="string">'create'</span> ? <span class="literal">null</span> : data.user_id,</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        required: <span class="literal">true</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">  &#125;)(</span><br><span class="line">    &lt;IDSelect</span><br><span class="line">      disabled=&#123;state.editType !== <span class="string">'create'</span>&#125;</span><br><span class="line">      list=&#123;state.users&#125;</span><br><span class="line">    /&gt;</span><br><span class="line">  )&#125;</span><br><span class="line">&lt;<span class="regexp">/FormItem&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="提交"><a href="#提交" class="headerlink" title="提交"></a>提交</h2><p>提交时，使用<code>form.validateFields</code>做校验，参数中<code>values</code>就是包含所有表单参数的map,map的key是<code>getFieldDecorator</code>的第一个参数。<em>例如上面的user_id</em></p>
<p>某些控件返回的数据并非后端需要的格式（例如DatePicker返回一个moment，Select返回一个String类型的ID），在提交到后端的API之前，在这里做格式的转换</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> handleSubmit = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  e.preventDefault();</span><br><span class="line">  form.validateFields(<span class="function">(<span class="params">err, values</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!err) &#123;</span><br><span class="line">        <span class="comment">// do submit</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="校验"><a href="#校验" class="headerlink" title="校验"></a><a href="https://github.com/yiminghe/async-validator" target="_blank" rel="noopener">校验</a></h2><p>规则见<a href="https://github.com/yiminghe/async-validator" target="_blank" rel="noopener">https://github.com/yiminghe/async-validator</a></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> checkCoordinate = <span class="function">(<span class="params">rule, value, callback</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span>(!parseCoordinate(value))&#123;</span><br><span class="line">    callback(<span class="string">"错误的经纬度"</span>);</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  callback();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&lt;FormItem&gt;</span><br><span class="line">  &#123;getFieldDecorator(<span class="string">'coordinate'</span>, &#123;</span><br><span class="line">    initialValue: state.editType === <span class="string">'create'</span> ? <span class="string">""</span> : <span class="built_in">String</span>(data.lng) + <span class="string">','</span> + <span class="built_in">String</span>(data.lat),</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        required: <span class="literal">true</span>,</span><br><span class="line">        min: <span class="number">1</span>,</span><br><span class="line">        max: <span class="number">64</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;<span class="attr">validator</span>: checkCoordinate&#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;)(&lt;Input placeholder="请输入经纬度" style=&#123;&#123;width: '100%'&#125;&#125;/&gt;)&#125;</span><br><span class="line">&lt;<span class="regexp">/FormItem&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  parseCoordinate:<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> values = value.split(<span class="string">","</span>);</span><br><span class="line">    <span class="keyword">if</span> (values.length !== <span class="number">2</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        lng: <span class="built_in">parseFloat</span>(values[<span class="number">0</span>]),</span><br><span class="line">        lat: <span class="built_in">parseFloat</span>(values[<span class="number">1</span>])</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="layout"><a href="#layout" class="headerlink" title="layout"></a>layout</h2><p>form有个全局的layout，参见<a href="https://ant.design/components/form/#API" target="_blank" rel="noopener">form</a>的layout参数。<code>&#39;horizontal&#39;|&#39;vertical&#39;|&#39;inline&#39;</code></p>
<p>若需要嵌套（例如每个input一行，某些行有多个input)，则需要借助<a href="https://ant.design/components/grid/#Col" target="_blank" rel="noopener">Col</a>来控制<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;FormItem</span><br><span class="line">  label=<span class="string">"位置"</span></span><br><span class="line">  required</span><br><span class="line">  &#123;...formItemLayout&#125;</span><br><span class="line">&gt;</span><br><span class="line">  &lt;Col span=&#123;<span class="number">6</span>&#125;&gt;</span><br><span class="line">    &lt;FormItem&gt;</span><br><span class="line">      &#123;getFieldDecorator(<span class="string">'param1'</span>, &#123;</span><br><span class="line">        initialValue: state.editType === <span class="string">'create'</span> ? <span class="string">""</span> : data.param1,</span><br><span class="line">        rules: [</span><br><span class="line">          &#123;</span><br><span class="line">            required: <span class="literal">true</span>,</span><br><span class="line">            min: <span class="number">1</span>,</span><br><span class="line">            max: <span class="number">32</span></span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;)(&lt;Input style=&#123;&#123;width: '100%'&#125;&#125;/&gt;)&#125;</span><br><span class="line">    &lt;<span class="regexp">/FormItem&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>Col&gt;</span><br><span class="line">  &lt;Col span=&#123;<span class="number">6</span>&#125;&gt;</span><br><span class="line">    &lt;FormItem&gt;</span><br><span class="line">      &#123;getFieldDecorator(<span class="string">'param2'</span>, &#123;</span><br><span class="line">        initialValue: state.editType === <span class="string">'create'</span> ? <span class="string">""</span> : data.param2,</span><br><span class="line">        rules: [</span><br><span class="line">          &#123;</span><br><span class="line">            required: <span class="literal">true</span>,</span><br><span class="line">            type: <span class="string">"integer"</span></span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;)(&lt;InputNumber style=&#123;&#123;width: '100%'&#125;&#125;/&gt;)&#125;</span><br><span class="line">    &lt;<span class="regexp">/FormItem&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>Col&gt;</span><br><span class="line">&lt;<span class="regexp">/FormItem&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>关于required的红点</p>
<p>若某个表单是必选的，左边的label会有个红色的*。但是对于一行有多个表单（只有一个左侧的label）默认情况下，不会有</p>
<p>解决办法是（见上面代码）在最外层的FormItem加上<code>required</code>，内层的无需处理<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 一行多表单</span></span><br><span class="line">&lt;FormItem</span><br><span class="line">  label=<span class="string">"位置"</span></span><br><span class="line">  required</span><br><span class="line">  &#123;...formItemLayout&#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></p>
<h1 id="富文本编辑器"><a href="#富文本编辑器" class="headerlink" title="富文本编辑器"></a>富文本编辑器</h1><p>官方推荐的<a href="https://github.com/leejaen/react-lz-editor" target="_blank" rel="noopener">react-lz-editor</a>相当不错，并且支持markdown和普通的<a href="https://baike.baidu.com/item/%E6%89%80%E8%A7%81%E5%8D%B3%E6%89%80%E5%BE%97/8721378?fr=aladdin&amp;fromid=190526&amp;fromtitle=WYSIWYG" target="_blank" rel="noopener">wysiwyg</a>模式，不过有一个需求（<code>粘贴富文本格式</code>)似乎满足不了,</p>
<p><a href="https://github.com/jpuri/react-draft-wysiwyg" target="_blank" rel="noopener">react-draft-wysiwyg</a>也是个不错的选择<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;Editor&#125; <span class="keyword">from</span> <span class="string">'react-draft-wysiwyg'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'react-draft-wysiwyg/dist/react-draft-wysiwyg.css'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; EditorState, convertToRaw, ContentState, convertFromHTML &#125; <span class="keyword">from</span> <span class="string">'draft-js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> checkContent = <span class="function">(<span class="params">rule, value, callback</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (value &amp;&amp; state.editorState) &#123;</span><br><span class="line">    <span class="keyword">const</span> content = draftToHtml(convertToRaw(state.editorState.getCurrentContent()));</span><br><span class="line">    <span class="keyword">if</span>(content.length &lt; <span class="number">9</span> || content.length &gt;= <span class="number">1024000</span>)&#123;</span><br><span class="line">      callback(<span class="string">"content must be between 2 and 1024000 characters\n"</span>);</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  callback();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> uploadImageCallBack = <span class="function">(<span class="params">file</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(</span><br><span class="line">    (resolve, reject) =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">      xhr.open(<span class="string">'POST'</span>, <span class="string">'/api/v1/upload'</span>);</span><br><span class="line">      <span class="keyword">const</span> data = <span class="keyword">new</span> FormData();</span><br><span class="line">      data.append(<span class="string">'file'</span>, file);</span><br><span class="line">      xhr.send(data);</span><br><span class="line">      xhr.addEventListener(<span class="string">'load'</span>, () =&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> response = <span class="built_in">JSON</span>.parse(xhr.responseText);</span><br><span class="line">        response = &#123; <span class="attr">data</span>: &#123; <span class="attr">link</span>: response.data.url,<span class="attr">alt</span>: <span class="string">"fasdf"</span> &#125; &#125;</span><br><span class="line">        resolve(response);</span><br><span class="line">      &#125;);</span><br><span class="line">      xhr.addEventListener(<span class="string">'error'</span>, () =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> error = <span class="built_in">JSON</span>.parse(xhr.responseText);</span><br><span class="line">        reject(error);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> onEditorStateChange = <span class="function">(<span class="params">editorState</span>) =&gt;</span> &#123;</span><br><span class="line">  dispatch(&#123;</span><br><span class="line">    type: <span class="string">`<span class="subst">$&#123;pageKey&#125;</span>/updateState`</span>,</span><br><span class="line">    payload: &#123;</span><br><span class="line">      editorState</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&lt;Editor</span><br><span class="line">  editorState=&#123;state.editorState&#125;</span><br><span class="line">  wrapperClassName=<span class="string">"demo-wrapper"</span></span><br><span class="line">  editorClassName=<span class="string">"demo-editor"</span></span><br><span class="line">  toolbar=&#123;&#123;</span><br><span class="line">    image: &#123; <span class="attr">uploadCallback</span>: uploadImageCallBack, <span class="attr">alt</span>: &#123; <span class="attr">present</span>: <span class="literal">false</span>, <span class="attr">mandatory</span>: <span class="literal">false</span> &#125; &#125;,</span><br><span class="line">  &#125;&#125;</span><br><span class="line">  onEditorStateChange=&#123;onEditorStateChange&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure></p>
<p>百度开源的<a href="http://ueditor.baidu.com/website/" target="_blank" rel="noopener">ueditor</a>非常完善,但是体积非常大，一个精简版<a href="http://ueditor.baidu.com/website/umeditor.html" target="_blank" rel="noopener">UMeditor</a></p>
<h1 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a><a href="https://ant.design/components/upload-cn/" target="_blank" rel="noopener">文件上传</a></h1><p>以下代码配合后端上传接口实现</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123;Upload&#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;connect&#125; <span class="keyword">from</span> <span class="string">'dva'</span></span><br><span class="line"><span class="keyword">import</span> &#123; config &#125; <span class="keyword">from</span> <span class="string">'../utils'</span></span><br><span class="line"><span class="keyword">import</span> &#123;Icon&#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> UploadButton = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;Icon type=<span class="string">"plus"</span> /&gt;</span><br><span class="line">    &lt;div className=<span class="string">"ant-upload-text"</span>&gt;点击上传&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> handleChange = <span class="function">(<span class="params">count</span>) =&gt;</span> <span class="function">(<span class="params">fileList</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 1. Limit the number of uploaded files</span></span><br><span class="line">  <span class="comment">//    Only to show two recent uploaded files, and old ones will be replaced by the new</span></span><br><span class="line">  fileList = fileList.slice(-count);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. filter successfully uploaded files according to response from server</span></span><br><span class="line">  fileList = fileList.filter(<span class="function">(<span class="params">file</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (file.response) &#123;</span><br><span class="line">      <span class="keyword">if</span> (file.response.code !== <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3. read from response and show file link</span></span><br><span class="line">  fileList = fileList.map(<span class="function">(<span class="params">file</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (file.response) &#123;</span><br><span class="line">      <span class="comment">// Component will show file.url as link</span></span><br><span class="line">      file.url = file.response.data.url;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> file;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> fileList</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> handleOneChange = <span class="function">(<span class="params">fileList</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> handleChange(<span class="number">1</span>)(fileList);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> normOneFile = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> res = e;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(e)) &#123;</span><br><span class="line">    res = e;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res = e.fileList</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (res.length &lt; <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">""</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> res[<span class="number">0</span>].url;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> normFile = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> res = e;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(e)) &#123;</span><br><span class="line">    res = e;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res = e.fileList</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (res.length &lt; <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">""</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> res.map(<span class="function"><span class="keyword">function</span>(<span class="params">object, i</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> object.url</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImageUploader</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> value = <span class="keyword">this</span>.props.value || [];</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      images: value</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentWillReceiveProps(nextProps) &#123;</span><br><span class="line">    <span class="comment">// Should be a controlled component.</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">'value'</span> <span class="keyword">in</span> nextProps &amp;&amp; !!nextProps.value) &#123;</span><br><span class="line">      <span class="keyword">const</span> value = nextProps.value;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 排除uploading的</span></span><br><span class="line">      <span class="keyword">if</span>(!value) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        images: [</span><br><span class="line">          &#123;</span><br><span class="line">            uid: <span class="number">-1</span>,</span><br><span class="line">            name: <span class="string">'test.png'</span>,</span><br><span class="line">            status: <span class="string">'done'</span>,</span><br><span class="line">            url: value</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> handleChangeImp = <span class="function">(<span class="params">info</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> res = handleOneChange(info.fileList)</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;<span class="attr">images</span>: res&#125;);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> onChange = <span class="keyword">this</span>.props.onChange;</span><br><span class="line">      <span class="keyword">if</span> (onChange) &#123;</span><br><span class="line">        onChange(res);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (&lt;span&gt;</span><br><span class="line">      &lt;Upload name="file" listType="picture-card" </span><br><span class="line">        fileList=&#123;this.state.images&#125; onChange=&#123;handleChangeImp&#125; action="/api/v1/upload"&gt;</span><br><span class="line">        &#123;</span><br><span class="line">          this.state.images.length &gt;= 1</span><br><span class="line">            ? null</span><br><span class="line">            : &lt;UploadButton/&gt;</span><br><span class="line">        &#125;</span><br><span class="line">      &lt;/Upload&gt;</span><br><span class="line">    &lt;/span&gt;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImageMultiUploader</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> value = <span class="keyword">this</span>.props.value || [];</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      images: value</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentWillReceiveProps(nextProps) &#123;</span><br><span class="line">    <span class="comment">// Should be a controlled component.</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">'value'</span> <span class="keyword">in</span> nextProps &amp;&amp; !!nextProps.value) &#123;</span><br><span class="line">      <span class="keyword">const</span> value = nextProps.value;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 排除uploading的</span></span><br><span class="line">      <span class="keyword">const</span> newValue = value.filter(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (!item);</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">if</span>(newValue.length &gt; <span class="number">0</span>) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> image_urls = [];</span><br><span class="line">      value.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">item, index</span>) </span>&#123;</span><br><span class="line">        image_urls.push(&#123;</span><br><span class="line">          uid: -(index + <span class="number">1</span>),</span><br><span class="line">          name: <span class="string">'test'</span> + index + <span class="string">'.png'</span>,</span><br><span class="line">          status: <span class="string">'done'</span>,</span><br><span class="line">          url: item</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;<span class="attr">images</span>: image_urls&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> handleChangeImp = <span class="function">(<span class="params">count</span>) =&gt;</span> <span class="function">(<span class="params">info</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> res = handleChange(count)(info.fileList)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;<span class="attr">images</span>: res&#125;);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> onChange = <span class="keyword">this</span>.props.onChange;</span><br><span class="line">      <span class="keyword">if</span> (onChange) &#123;</span><br><span class="line">        onChange(res);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (&lt;span&gt;</span><br><span class="line">      &lt;Upload name="file" listType="picture-card" fileList=&#123;this.state.images&#125; </span><br><span class="line">      onChange=&#123;handleChangeImp(this.props.maxImage)&#125; action="/api/v1/upload"&gt;</span><br><span class="line">        &#123;</span><br><span class="line">          this.state.images.length &gt;= this.props.maxImage</span><br><span class="line">            ? null</span><br><span class="line">            : &lt;UploadButton/&gt;</span><br><span class="line">        &#125;</span><br><span class="line">      &lt;/Upload&gt;</span><br><span class="line">    &lt;/span&gt;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  ImageUploader,</span><br><span class="line">  ImageMultiUploader,</span><br><span class="line">  normOneFile,</span><br><span class="line">  normFile</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;FormItem</span><br><span class="line">  &#123;...formItemLayout&#125;</span><br><span class="line">  label=<span class="string">"照片"</span></span><br><span class="line">&gt;</span><br><span class="line">  &#123;getFieldDecorator(<span class="string">'image_url'</span>, &#123;</span><br><span class="line">    initialValue: state.editType === <span class="string">'create'</span> ? <span class="string">""</span> : data.image_url,</span><br><span class="line">    getValueFromEvent: normOneFile,</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        required: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;)(</span><br><span class="line">    &lt;ImageUploader /&gt;</span><br><span class="line">  )&#125;</span><br><span class="line">&lt;<span class="regexp">/FormItem&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="一些不错的三方库"><a href="#一些不错的三方库" class="headerlink" title="一些不错的三方库"></a>一些不错的三方库</h1><ol>
<li><a href="https://github.com/facebook/prop-types" target="_blank" rel="noopener">prop-types</a>,检查组件参数</li>
<li><a href="https://github.com/pillarjs/path-to-regexp" target="_blank" rel="noopener">path-to-regexp</a>,url工具库</li>
<li><a href="https://github.com/nfl/react-helmet" target="_blank" rel="noopener">react-helmet</a>,设置title以及头部信息</li>
<li><a href="https://github.com/rstacruz/nprogress" target="_blank" rel="noopener">nprogress</a>,加载进度条，和dva-loading配合使用</li>
<li><a href="https://github.com/axios/axios" target="_blank" rel="noopener">axios</a>,基于promise的http客户端库，dva-admin实现了一个比较完善的<a href="https://github.com/zuiidea/antd-admin/blob/master/src/utils/request.js" target="_blank" rel="noopener">request函数</a></li>
<li><a href="https://github.com/sindresorhus/query-string" target="_blank" rel="noopener">query-string</a>，解析url查询参数</li>
<li><a href="https://github.com/ElemeFE/react-amap" target="_blank" rel="noopener">react-amap</a>，高德地图</li>
<li><a href="https://github.com/alexei/sprintf.js/" target="_blank" rel="noopener">sprintf.js</a>,类似于C printf的占位符打印实现</li>
<li><a href="https://github.com/kaivi/ReactInlineEdit" target="_blank" rel="noopener">ReactInlineEdit</a>,双击编辑控件</li>
<li><a href="https://github.com/ljharb/qs" target="_blank" rel="noopener">qs</a>,A querystring parser with nesting support</li>
<li><a href="https://github.com/lodash/lodash" target="_blank" rel="noopener">lodash</a>,工具库</li>
<li>其他<a href="https://ant.design/docs/react/recommendation-cn" target="_blank" rel="noopener">https://ant.design/docs/react/recommendation-cn</a></li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (lastHref !== href) &#123;</span><br><span class="line">  NProgress.start()</span><br><span class="line">  <span class="keyword">if</span> (!loading.global) &#123;</span><br><span class="line">    NProgress.done()</span><br><span class="line">    lastHref = href</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="日期"><a href="#日期" class="headerlink" title="日期"></a>日期</h1><p>antd使用moment作为日期处理库</p>
<p>获取当月/指定月的区间</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Moment <span class="keyword">from</span> <span class="string">'moment'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getMonthDateRange = <span class="function">(<span class="params">param</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> startDate = Moment([param.year(), param.month()]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Clone the value before .endOf()</span></span><br><span class="line">  <span class="keyword">const</span> endDate = Moment(startDate).endOf(<span class="string">'month'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// make sure to call toDate() for plain JavaScript date type</span></span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">from</span>: startDate, <span class="attr">to</span>: endDate &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getCurMonthRange = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> getMonthDateRange(Moment())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  getMonthDateRange,</span><br><span class="line">  getCurMonthRange,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="DatePicker"><a href="#DatePicker" class="headerlink" title="DatePicker"></a><a href="https://ant.design/components/date-picker/" target="_blank" rel="noopener">DatePicker</a></h2><p>最新的DatePicker输入输出都是一个moment对象，下面的代码做了个处理，输入输出都是如<code>2017-12-04</code>的这种格式</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123;DatePicker&#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;connect&#125; <span class="keyword">from</span> <span class="string">'dva'</span></span><br><span class="line"><span class="keyword">import</span> &#123;config&#125; <span class="keyword">from</span> <span class="string">'../utils'</span></span><br><span class="line"><span class="keyword">import</span> &#123;Icon&#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"><span class="keyword">import</span> moment <span class="keyword">from</span> <span class="string">'moment'</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span>;</span><br><span class="line"><span class="keyword">const</span> RangePicker = DatePicker.RangePicker;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StringDatePicker</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> value = <span class="keyword">this</span>.props.value || [];</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      current_value: <span class="literal">undefined</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentWillReceiveProps(nextProps) &#123;</span><br><span class="line">    <span class="comment">// Should be a controlled component.</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">'value'</span> <span class="keyword">in</span> nextProps) &#123;</span><br><span class="line">      <span class="keyword">const</span> value = nextProps.value;</span><br><span class="line">      <span class="keyword">if</span>(value === <span class="literal">undefined</span>) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!value)&#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;<span class="attr">current_value</span>: <span class="literal">null</span>&#125;);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">const</span> current_value = moment(value, <span class="string">'YYYY-MM-DD'</span>)</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;current_value&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> handleChange = <span class="function">(<span class="params">value, dateString</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> current_value = <span class="literal">null</span>;</span><br><span class="line">      <span class="keyword">if</span>(!!value)&#123;</span><br><span class="line">        current_value = value.format(<span class="string">'YYYY-MM-DD'</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        current_value</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> onChange = <span class="keyword">this</span>.props.onChange;</span><br><span class="line">      <span class="keyword">if</span> (onChange) &#123;</span><br><span class="line">        onChange(current_value);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;span&gt;</span><br><span class="line">      &#123;<span class="keyword">this</span>.state.current_value !== <span class="literal">undefined</span> &amp;&amp; &lt;DatePicker</span><br><span class="line">        defaultValue=&#123;this.state.current_value&#125;</span><br><span class="line">        onChange=&#123;handleChange&#125;</span><br><span class="line">        showToday=&#123;true&#125;</span><br><span class="line">      /&gt;&#125;</span><br><span class="line">      &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">StringDatePicker.propTypes = &#123;</span></span><br><span class="line"><span class="regexp">  value: PropTypes.string</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">class StringRangePicker extends React.Component &#123;</span></span><br><span class="line"><span class="regexp">  constructor(props) &#123;</span></span><br><span class="line"><span class="regexp">    super(props);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    const value = this.props.value || [];</span></span><br><span class="line"><span class="regexp">    this.state = &#123;</span></span><br><span class="line"><span class="regexp">      current_value: undefined</span></span><br><span class="line"><span class="regexp">    &#125;;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  componentWillReceiveProps(nextProps) &#123;</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ Should be a controlled component.</span></span><br><span class="line"><span class="regexp">    if ('value' in nextProps) &#123;</span></span><br><span class="line"><span class="regexp">      const value = nextProps.value;</span></span><br><span class="line"><span class="regexp">      if(value === undefined) return</span></span><br><span class="line"><span class="regexp">      if(!!value &amp;&amp; value.length &gt; 0)&#123;</span></span><br><span class="line"><span class="regexp">        const newValue = value.filter(function(item) &#123;</span></span><br><span class="line"><span class="regexp">          return (!!item);</span></span><br><span class="line"><span class="regexp">        &#125;);</span></span><br><span class="line"><span class="regexp">        if(newValue.length !== value.length)</span></span><br><span class="line"><span class="regexp">          return;</span></span><br><span class="line"><span class="regexp">      &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">      if (!value)&#123;</span></span><br><span class="line"><span class="regexp">        this.setState(&#123;current_value: []&#125;);</span></span><br><span class="line"><span class="regexp">        return;</span></span><br><span class="line"><span class="regexp">      &#125;</span></span><br><span class="line"><span class="regexp">      const current_value = value.map(item=&gt;moment(item, 'YYYY-MM-DD'))</span></span><br><span class="line"><span class="regexp">      this.setState(&#123;current_value&#125;);</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  render() &#123;</span></span><br><span class="line"><span class="regexp">    const handleChange = (value, dateString) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">      let current_value = null;</span></span><br><span class="line"><span class="regexp">      if(!!value)&#123;</span></span><br><span class="line"><span class="regexp">        current_value=value.map(item=&gt;item.format('YYYY-MM-DD'))</span></span><br><span class="line"><span class="regexp">      &#125;</span></span><br><span class="line"><span class="regexp">      this.setState(&#123;</span></span><br><span class="line"><span class="regexp">        current_value</span></span><br><span class="line"><span class="regexp">      &#125;)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">      const onChange = this.props.onChange;</span></span><br><span class="line"><span class="regexp">      if (onChange) &#123;</span></span><br><span class="line"><span class="regexp">        onChange(current_value);</span></span><br><span class="line"><span class="regexp">      &#125;</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    return (</span></span><br><span class="line"><span class="regexp">      &lt;span&gt;</span></span><br><span class="line"><span class="regexp">      &#123;this.state.current_value !== undefined &amp;&amp; &lt;RangePicker</span></span><br><span class="line"><span class="regexp">        defaultValue=&#123;this.state.current_value&#125;</span></span><br><span class="line"><span class="regexp">        onChange=&#123;handleChange&#125;</span></span><br><span class="line"><span class="regexp">        showToday=&#123;true&#125;</span></span><br><span class="line"><span class="regexp">      /</span>&gt;&#125;</span><br><span class="line">      &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">StringRangePicker.propTypes = &#123;</span></span><br><span class="line"><span class="regexp">  value: PropTypes.arrayOf(PropTypes.string)</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">module.exports = &#123;</span></span><br><span class="line"><span class="regexp">  StringDatePicker,</span></span><br><span class="line"><span class="regexp">  StringRangePicker,</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure>
<h1 id="高德地图"><a href="#高德地图" class="headerlink" title="高德地图"></a>高德地图</h1><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123;mapKey&#125; <span class="keyword">from</span> <span class="string">'../../utils/config'</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="built_in">Map</span>, Marker &#125; <span class="keyword">from</span> <span class="string">'react-amap'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> AMap = <span class="function">(<span class="params">&#123;lng,lat&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span>  plugins = [</span><br><span class="line">    <span class="string">'MapType'</span>,</span><br><span class="line">    <span class="string">'Scale'</span>,</span><br><span class="line">    <span class="string">'OverView'</span>,</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div style=&#123;&#123;<span class="attr">width</span>:<span class="string">"100%"</span>,<span class="attr">minHeight</span>:<span class="string">"400px"</span>&#125;&#125;&gt;</span><br><span class="line">      &lt;<span class="built_in">Map</span> amapkey=&#123;mapKey&#125;</span><br><span class="line">           plugins=&#123;plugins&#125;</span><br><span class="line">           zoom=&#123;<span class="number">15</span>&#125;</span><br><span class="line">           center=&#123;&#123;<span class="attr">longitude</span>: lng, <span class="attr">latitude</span>: lat&#125;&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;Marker position=&#123;&#123;<span class="attr">longitude</span>: lng, <span class="attr">latitude</span>: lat&#125;&#125; /&gt;</span><br><span class="line">      &lt;<span class="regexp">/Map&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> AMap</span><br></pre></td></tr></table></figure>
<h1 id="Layout"><a href="#Layout" class="headerlink" title="Layout"></a>Layout</h1><p>一个常见的管理系统后台，通常都包含一些共有的组件，例如左侧<a href="https://ant.design/components/menu/" target="_blank" rel="noopener">菜单</a>入口，上面导航条，底部说明，<a href="https://ant.design/components/breadcrumb/" target="_blank" rel="noopener">面包屑菜单</a>等</p>
<p>antd admin的实现参考<a href="https://github.com/zuiidea/antd-admin/tree/master/src/components/Layout" target="_blank" rel="noopener">https://github.com/zuiidea/antd-admin/tree/master/src/components/Layout</a></p>
<p>antd admin通过route的一个简单设计，是的每个子页面都无需考虑这些在它外围的基础控件</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Routers = <span class="function"><span class="keyword">function</span> (<span class="params">&#123;history, app&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> error = dynamic(&#123;</span><br><span class="line">    app,</span><br><span class="line">    component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./routes/error'</span>),</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">const</span> routes = [</span><br><span class="line">    &#123;</span><br><span class="line">      path: route.users,</span><br><span class="line">      models: <span class="function"><span class="params">()</span> =&gt;</span> [<span class="keyword">import</span>(<span class="string">'./models/user/index'</span>)],</span><br><span class="line">      component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./routes/user/index'</span>),</span><br><span class="line">    &#125;,&#123;</span><br><span class="line">      path: route.userLogin,</span><br><span class="line">      component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./routes/login/'</span>),</span><br><span class="line">    &#125;</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;ConnectedRouter history=&#123;history&#125;&gt;</span><br><span class="line">      &lt;App&gt;</span><br><span class="line">        &lt;Switch&gt;</span><br><span class="line">          &lt;Route exact path=<span class="string">"/"</span> render=&#123;() =&gt; (&lt;Redirect to="/user"/&gt;)&#125;/&gt;</span><br><span class="line">          &#123;</span><br><span class="line">            routes.map(<span class="function">(<span class="params">&#123;path, ...dynamics&#125;, key</span>) =&gt;</span> (</span><br><span class="line">              &lt;Route key=&#123;key&#125;</span><br><span class="line">                     exact</span><br><span class="line">                     path=&#123;path&#125;</span><br><span class="line">                     component=&#123;dynamic(&#123;</span><br><span class="line">                       app,</span><br><span class="line">                       ...dynamics,</span><br><span class="line">                     &#125;)&#125;</span><br><span class="line">              /&gt;</span><br><span class="line">            ))</span><br><span class="line">          &#125;</span><br><span class="line">          &lt;Route component=&#123;error&#125;/&gt;</span><br><span class="line">        &lt;<span class="regexp">/Switch&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>App&gt;</span><br><span class="line">    &lt;<span class="regexp">/ConnectedRouter&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure>
<p>所有的Page都包含在App Page里面</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* global window */</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> NProgress <span class="keyword">from</span> <span class="string">'nprogress'</span></span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span></span><br><span class="line"><span class="keyword">import</span> pathToRegexp <span class="keyword">from</span> <span class="string">'path-to-regexp'</span></span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'dva'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Layout, Loader &#125; <span class="keyword">from</span> <span class="string">'components'</span></span><br><span class="line"><span class="keyword">import</span> &#123; classnames, config &#125; <span class="keyword">from</span> <span class="string">'utils'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Helmet &#125; <span class="keyword">from</span> <span class="string">'react-helmet'</span></span><br><span class="line"><span class="keyword">import</span> &#123; withRouter &#125; <span class="keyword">from</span> <span class="string">'dva/router'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'../themes/index.less'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./app.less'</span></span><br><span class="line"><span class="keyword">import</span> <span class="built_in">Error</span> <span class="keyword">from</span> <span class="string">'./error'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; prefix, openPages,name &#125; = config</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; Header, Bread, Footer, Sider, styles &#125; = Layout</span><br><span class="line"><span class="keyword">let</span> lastHref</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">(<span class="params">&#123; children, dispatch, app, loading, location &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 顶部进度条</span></span><br><span class="line">  <span class="keyword">if</span> (lastHref !== href) &#123;</span><br><span class="line">    NProgress.start()</span><br><span class="line">    <span class="keyword">if</span> (!loading.global) &#123;</span><br><span class="line">      NProgress.done()</span><br><span class="line">      lastHref = href</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (openPages &amp;&amp; openPages.includes(pathname)) &#123;</span><br><span class="line">	<span class="comment">// 对于特殊的页面，比如login，直接返回Page内容，而不在外面包含公用的组件</span></span><br><span class="line">    <span class="keyword">return</span> (&lt;div&gt;</span><br><span class="line">      &lt;Loader fullScreen spinning=&#123;loading.effects['app/query']&#125; /&gt;</span><br><span class="line">      &#123;children&#125;</span><br><span class="line">    &lt;/div&gt;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;<span class="comment">/* 全局的loading效果 */</span>&#125;</span><br><span class="line">      &lt;Loader fullScreen spinning=&#123;loading.effects[<span class="string">'app/query'</span>]&#125; /&gt;</span><br><span class="line">      &#123;<span class="comment">/* html title、配置等 */</span>&#125;</span><br><span class="line">      &lt;Helmet&gt;</span><br><span class="line">        &lt;title&gt;&#123; name &#125;&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">        &lt;meta name="viewport" content="width=device-width, initial-scale=1.0" /</span>&gt;</span><br><span class="line">        &lt;link rel=<span class="string">"icon"</span> href=&#123;logo&#125; type=<span class="string">"image/x-icon"</span> /&gt;</span><br><span class="line">        &#123;iconFontJS &amp;&amp; &lt;script src=&#123;iconFontJS&#125; /&gt;&#125;</span><br><span class="line">        &#123;iconFontCSS &amp;&amp; &lt;link rel="stylesheet" href=&#123;iconFontCSS&#125; /&gt;&#125;</span><br><span class="line">      &lt;<span class="regexp">/Helmet&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div className=&#123;classnames(styles.layout, &#123; [styles.fold]: isNavbar ? false : siderFold &#125;, &#123; [styles.withnavbar]: isNavbar &#125;)&#125;&gt;</span></span><br><span class="line"><span class="regexp">		/</span><span class="regexp">/ 侧边菜单</span></span><br><span class="line"><span class="regexp">        &#123;!isNavbar ? &lt;aside className=&#123;classnames(styles.sider, [styles.light])&#125;&gt;</span></span><br><span class="line"><span class="regexp">          &#123;siderProps.menu.length === 0 ? null : &lt;Sider &#123;...siderProps&#125; /</span>&gt;&#125;</span><br><span class="line">        &lt;<span class="regexp">/aside&gt; : ''&#125;</span></span><br><span class="line"><span class="regexp">        &lt;div className=&#123;styles.main&#125;&gt;</span></span><br><span class="line"><span class="regexp">	      /</span><span class="regexp">/ 顶部导航</span></span><br><span class="line"><span class="regexp">          &lt;Header &#123;...headerProps&#125; /</span>&gt;</span><br><span class="line">	      <span class="comment">// 面包屑菜单</span></span><br><span class="line">          &lt;Bread &#123;...breadProps&#125; /&gt;</span><br><span class="line">		  <span class="comment">// 每个页面实际的内容</span></span><br><span class="line">          &lt;div className=&#123;styles.container&#125;&gt;</span><br><span class="line">            &lt;div className=&#123;styles.content&#125;&gt;</span><br><span class="line">              &#123;hasPermission ? children : &lt;Error /&gt;&#125;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>div&gt;</span><br><span class="line">          <span class="comment">// 底部说明</span></span><br><span class="line">          &lt;Footer /&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default withRouter(connect((&#123; app, loading &#125;) =&gt; (&#123; app, loading &#125;))(App))</span></span><br></pre></td></tr></table></figure>
<p>这种设计的好处是可以利用App的model处理一些通用的东西，比如</p>
<p>全局的错误监听(models/app.js)<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">setup(&#123;dispatch, history&#125;) &#123;</span><br><span class="line">  <span class="comment">// Add a response interceptor</span></span><br><span class="line">  axios.interceptors.response.use(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Do something with response data</span></span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">  &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123;response&#125; = error</span><br><span class="line">  <span class="keyword">let</span> msg;</span><br><span class="line">  <span class="keyword">let</span> statusCode;</span><br><span class="line">  <span class="keyword">if</span> (response &amp;&amp; response <span class="keyword">instanceof</span> <span class="built_in">Object</span>) &#123;</span><br><span class="line">    statusCode = response.status</span><br><span class="line">    <span class="keyword">if</span> (statusCode === <span class="number">401</span>) &#123;</span><br><span class="line">      <span class="comment">// Do something with response error</span></span><br><span class="line">      dispatch(&#123;</span><br><span class="line">        type: <span class="string">'unauthorized'</span>,</span><br><span class="line">        payload: error,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>添加路径/路由信息，以及处理一些自动的跳转（登录成功后，存在cookie访问login页面等）<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">history.listen(<span class="function">(<span class="params">location</span>) =&gt;</span> &#123;</span><br><span class="line">  dispatch(&#123;</span><br><span class="line">    type: <span class="string">'updateState'</span>,</span><br><span class="line">    payload: &#123;</span><br><span class="line">      locationPathname: location.pathname,</span><br><span class="line">      locationQuery: queryString.parse(location.search),</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> match = pathToRegexp(route.userLoginCB).exec(location.pathname)</span><br><span class="line">  <span class="keyword">if</span> (!match) &#123;</span><br><span class="line">    dispatch(&#123;<span class="attr">type</span>: <span class="string">'query'</span>&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>授权检查拦截<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">* query(&#123;</span><br><span class="line">          payload,</span><br><span class="line">        &#125;, &#123;call, put, select&#125;) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123;locationPathname, locationQuery&#125; = <span class="keyword">yield</span> select(<span class="function"><span class="params">_</span> =&gt;</span> _.app);</span><br><span class="line">  <span class="comment">// 如果不是登录页，那么如果存在就不再查询</span></span><br><span class="line">  <span class="keyword">const</span> match = pathToRegexp(route.userLogin).exec(locationPathname);</span><br><span class="line">  <span class="keyword">if</span> (!match) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;user&#125; = <span class="keyword">yield</span> select(<span class="function"><span class="params">_</span> =&gt;</span> _.app);</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">"id"</span> <span class="keyword">in</span> user) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123;data&#125; = <span class="keyword">yield</span> call(query, payload);</span><br><span class="line">  <span class="keyword">if</span> (data) &#123;</span><br><span class="line">    <span class="keyword">const</span> menuData = <span class="keyword">yield</span> call(menusService.services.query);</span><br><span class="line">    <span class="keyword">let</span> user = data</span><br><span class="line">    <span class="keyword">let</span> menu = menuData.data;</span><br><span class="line">    <span class="keyword">let</span> visit = menu.map(<span class="function"><span class="params">item</span> =&gt;</span> item.id);</span><br><span class="line">    <span class="keyword">yield</span> put(&#123;</span><br><span class="line">      type: <span class="string">'updateState'</span>,</span><br><span class="line">      payload: &#123;</span><br><span class="line">        user,</span><br><span class="line">        menu,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (locationPathname === route.userLogin) &#123;</span><br><span class="line">      <span class="keyword">if</span> (locationQuery[<span class="string">"url"</span>]) &#123;</span><br><span class="line">        <span class="built_in">window</span>.location.assign(locationQuery[<span class="string">"url"</span>]);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">yield</span> put(routerRedux.replace(&#123;</span><br><span class="line">          pathname: indexPage,</span><br><span class="line">        &#125;))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (config.openPages &amp;&amp; config.openPages.indexOf(locationPathname) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">yield</span> put(routerRedux.push(&#123;</span><br><span class="line">      pathname: route.userLogin,</span><br><span class="line">      search: queryString.stringify(&#123;</span><br><span class="line">        <span class="keyword">from</span>: locationPathname,</span><br><span class="line">      &#125;),</span><br><span class="line">    &#125;))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">* unauthorized(action, &#123;put, select&#125;) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;locationPathname&#125; = <span class="keyword">yield</span> select(<span class="function"><span class="params">_</span> =&gt;</span> _.app)</span><br><span class="line">  <span class="keyword">if</span> (locationPathname !== route.userLogin) &#123;</span><br><span class="line">    <span class="keyword">yield</span> put(routerRedux.push(&#123;</span><br><span class="line">      pathname: route.userLogin,</span><br><span class="line">      search: queryString.stringify(&#123;</span><br><span class="line">        url: <span class="built_in">window</span>.location.href</span><br><span class="line">      &#125;),</span><br><span class="line">    &#125;))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<p>当然一些全局的操作，比如logout处理，左侧菜单栏收房，面包屑菜单处理等也可以在这里一并处理好</p>
<h2 id="面包屑菜单"><a href="#面包屑菜单" class="headerlink" title="面包屑菜单"></a>面包屑菜单</h2><p>左侧导航菜单的内容，从后端拉取，后端可以根据权限返回有限的数据</p>
<p>antd-admin的实现见<a href="https://github.com/zuiidea/antd-admin/blob/master/src/components/Layout/Menu.js" target="_blank" rel="noopener">https://github.com/zuiidea/antd-admin/blob/master/src/components/Layout/Menu.js</a></p>
<p>输入的菜单数据是个数组，在前端组装一个树结构，由于后端通常也是一个配置来写这些菜单，数组结构抽象树结构很难理解，所以可以考虑将输入也接收树结构，利于后端编辑</p>
<p>为了适配面包屑菜单，后端返回的菜单数据，有一种<code>隐藏</code>item,这种item不显示在左边菜单，而仅仅用于面包屑菜单匹配</p>
<p>ant-admin的<a href="https://github.com/zuiidea/antd-admin/blob/master/src/components/Layout/Bread.js" target="_blank" rel="noopener">Bread</a>没有支持导航带参数的链接。比如</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[首页] =&gt; [用户列表] =&gt; [用户详情] =&gt; [用户编辑]</span><br></pre></td></tr></table></figure>
<p>一般的做法，用户详情/编辑的地址会有一个user_id，而不是固定的（例如用户列表这种）</p>
<p>基于<code>面包屑菜单所需要的参数在当前page中都存在</code>的假设，可以如下处理<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Breadcrumb, Icon &#125; <span class="keyword">from</span> <span class="string">'antd'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"><span class="keyword">import</span> pathToRegexp <span class="keyword">from</span> <span class="string">'path-to-regexp'</span></span><br><span class="line"><span class="keyword">import</span> &#123; queryArray &#125; <span class="keyword">from</span> <span class="string">'utils'</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">'./Bread.less'</span></span><br><span class="line"><span class="keyword">import</span> &#123;parseUrl,buildUrl&#125; <span class="keyword">from</span> <span class="string">'../../utils/url'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Bread = <span class="function">(<span class="params">&#123; menu, location &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 匹配当前路由</span></span><br><span class="line">  <span class="keyword">let</span> pathArray = []</span><br><span class="line">  <span class="keyword">let</span> current;</span><br><span class="line">  <span class="keyword">let</span> match;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> index <span class="keyword">in</span> menu) &#123;</span><br><span class="line">    <span class="keyword">if</span> (menu[index].route) &#123;</span><br><span class="line">      match = pathToRegexp(menu[index].route).exec(location.pathname);</span><br><span class="line">      <span class="keyword">if</span>(match)&#123;</span><br><span class="line">        current = menu[index];</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> getPathArray = <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    pathArray.unshift(item);</span><br><span class="line">    <span class="keyword">if</span> (item.pid) &#123;</span><br><span class="line">      getPathArray(queryArray(menu, item.pid, <span class="string">'id'</span>))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!current) &#123;</span><br><span class="line">    pathArray.push(menu[<span class="number">0</span>] || &#123;</span><br><span class="line">      id: <span class="number">1</span>,</span><br><span class="line">      icon: <span class="string">'laptop'</span>,</span><br><span class="line">      name: <span class="string">'Dashboard'</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    pathArray.push(&#123;</span><br><span class="line">      id: <span class="number">404</span>,</span><br><span class="line">      name: <span class="string">'Not Found'</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    getPathArray(current)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 自动填充</span></span><br><span class="line">  <span class="keyword">if</span>(current)&#123;</span><br><span class="line">    <span class="keyword">const</span> urlDatas = parseUrl(location.pathname, current.route);</span><br><span class="line">    pathArray.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(item === current || !item.route) <span class="keyword">return</span>;</span><br><span class="line">      item.route2 = buildUrl(item.route,urlDatas)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 递归查找父级</span></span><br><span class="line">  <span class="keyword">const</span> breads = pathArray.map(<span class="function">(<span class="params">item, key</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> content = (</span><br><span class="line">      &lt;span&gt;&#123;item.icon</span><br><span class="line">        ? &lt;Icon type=&#123;item.icon&#125; style=&#123;&#123; marginRight: 4 &#125;&#125; /&gt;</span><br><span class="line">        : <span class="string">''</span>&#125;&#123;item.name&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">    return (</span></span><br><span class="line"><span class="regexp">      &lt;Breadcrumb.Item key=&#123;key&#125;&gt;</span></span><br><span class="line"><span class="regexp">        &#123;((pathArray.length - 1) !== key &amp;&amp; "route" in item)</span></span><br><span class="line"><span class="regexp">          ? &lt;Link to=&#123;item.route2 || '#'&#125;&gt;</span></span><br><span class="line"><span class="regexp">            &#123;content&#125;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>Link&gt;</span><br><span class="line">          : content&#125;</span><br><span class="line">      &lt;<span class="regexp">/Breadcrumb.Item&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;)</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;div className=&#123;styles.bread&#125;&gt;</span></span><br><span class="line"><span class="regexp">      &lt;Breadcrumb&gt;</span></span><br><span class="line"><span class="regexp">        &#123;breads&#125;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>Breadcrumb&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">Bread.propTypes = &#123;</span></span><br><span class="line"><span class="regexp">  menu: PropTypes.array,</span></span><br><span class="line"><span class="regexp">  location: PropTypes.object,</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Bread</span></span><br></pre></td></tr></table></figure></p>
<h1 id="省市区"><a href="#省市区" class="headerlink" title="省市区"></a>省市区</h1><p>基于动态读取后端数据的省市区控件</p>
<p>数据来源<a href="https://gitee.com/nxs/nation-province-city-district" target="_blank" rel="noopener">腾讯地图LBS</a></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123;Cascader&#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;connect&#125; <span class="keyword">from</span> <span class="string">'dva'</span></span><br><span class="line"><span class="keyword">import</span> &#123; config &#125; <span class="keyword">from</span> <span class="string">'../utils'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Geography</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      options: [],</span><br><span class="line">      current_province: <span class="literal">null</span>,</span><br><span class="line">      current_city: <span class="literal">null</span>,</span><br><span class="line">      current_area: <span class="literal">null</span>,</span><br><span class="line">      default_value: <span class="literal">null</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  updateConfig()&#123;</span><br><span class="line">    <span class="keyword">let</span> options = [];</span><br><span class="line">    <span class="keyword">const</span> &#123;provinces,citys,areas&#125; = <span class="keyword">this</span>.props</span><br><span class="line">    <span class="keyword">const</span> state = <span class="keyword">this</span>.state</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!!provinces)&#123;</span><br><span class="line">      provinces.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">        options.push(&#123;</span><br><span class="line">          value: item.id,</span><br><span class="line">          label: item.fullname,</span><br><span class="line">          isLeaf: <span class="literal">false</span>,</span><br><span class="line">          type: <span class="string">'province'</span>,</span><br><span class="line">          data: item,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> currentCitys = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span>(!!state.current_province &amp;&amp; !!citys) &#123;</span><br><span class="line">      options.find(<span class="function"><span class="keyword">function</span>(<span class="params">province</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(province.value == state.current_province)&#123;</span><br><span class="line">          <span class="keyword">let</span> tmp_citys = []</span><br><span class="line">          citys.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">            tmp_citys.push(&#123;</span><br><span class="line">              value: item.id,</span><br><span class="line">              label: item.fullname,</span><br><span class="line">              isLeaf: <span class="literal">false</span>,</span><br><span class="line">              type: <span class="string">'city'</span>,</span><br><span class="line">              data: item,</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line">          currentCitys = tmp_citys;</span><br><span class="line">          province.children = tmp_citys;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!!currentCitys &amp;&amp; !!state.current_city &amp;&amp; !!areas)&#123;</span><br><span class="line">      currentCitys.find(<span class="function"><span class="keyword">function</span>(<span class="params">city</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(city.value == state.current_city)&#123;</span><br><span class="line">          <span class="keyword">let</span> tmp_areas = []</span><br><span class="line">          areas.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">            tmp_areas.push(&#123;</span><br><span class="line">              value: item.id,</span><br><span class="line">              label: item.fullname,</span><br><span class="line">              isLeaf: <span class="literal">true</span>,</span><br><span class="line">              type: <span class="string">'area'</span>,</span><br><span class="line">              data: item,</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line">          city.children = tmp_areas;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      options,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentWillReceiveProps(nextProps) &#123;</span><br><span class="line">    <span class="comment">// Should be a controlled component.</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.state.default_value === <span class="literal">null</span> &amp;&amp; <span class="string">'value'</span> <span class="keyword">in</span> nextProps) &#123;</span><br><span class="line">      <span class="keyword">let</span> value = nextProps.value</span><br><span class="line">      <span class="keyword">if</span>(!value)&#123;</span><br><span class="line">        value = []</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span>(value.length &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> newValue = value.filter(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> (!!item);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">if</span>(newValue.length !== value.length)</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">this</span>.props.initGeography(value);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> current_province = <span class="literal">null</span>;</span><br><span class="line">      <span class="keyword">let</span> current_city = <span class="literal">null</span>;</span><br><span class="line">      <span class="keyword">let</span> current_area = <span class="literal">null</span>;</span><br><span class="line">      <span class="keyword">if</span>(nextProps.value.length === <span class="number">3</span>)&#123;</span><br><span class="line">        current_province = nextProps.value[<span class="number">0</span>];</span><br><span class="line">        current_city = nextProps.value[<span class="number">1</span>];</span><br><span class="line">        current_area = nextProps.value[<span class="number">2</span>];</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        default_value: value,</span><br><span class="line">        current_province,</span><br><span class="line">        current_city,</span><br><span class="line">        current_area</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.state.default_value !== <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">this</span>.updateConfig()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span>  loadData = <span class="function">(<span class="params">selectedOptions</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> targetOption = selectedOptions[selectedOptions.length - <span class="number">1</span>];</span><br><span class="line">      targetOption.loading = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">if</span>(targetOption.type == <span class="string">'province'</span>)&#123;</span><br><span class="line">        <span class="keyword">this</span>.props.getCitys(targetOption.data);</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">          current_province: targetOption.data.id,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;<span class="keyword">else</span> <span class="keyword">if</span>(targetOption.type == <span class="string">'city'</span>)&#123;</span><br><span class="line">        <span class="keyword">this</span>.props.getAreas(targetOption.data);</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">          current_city: targetOption.data.id,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      targetOption.loading = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> onChange = <span class="function">(<span class="params">value, selectedOptions</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span>(selectedOptions.length == <span class="number">3</span> || selectedOptions.length == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> onChange = <span class="keyword">this</span>.props.onChange;</span><br><span class="line">        <span class="keyword">if</span>(selectedOptions.length == <span class="number">3</span>)&#123;</span><br><span class="line">          <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            current_province: selectedOptions[<span class="number">0</span>].data.id,</span><br><span class="line">            current_city: selectedOptions[<span class="number">1</span>].data.id,</span><br><span class="line">            current_area: selectedOptions[<span class="number">2</span>].data.id,</span><br><span class="line">          &#125;)</span><br><span class="line">          <span class="keyword">if</span> (onChange) &#123;</span><br><span class="line">            onChange(selectedOptions.map(<span class="function"><span class="params">x</span>=&gt;</span>x.data.id));</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            current_province: <span class="literal">null</span>,</span><br><span class="line">            current_city: <span class="literal">null</span>,</span><br><span class="line">            current_area: <span class="literal">null</span>,</span><br><span class="line">          &#125;)</span><br><span class="line">          <span class="keyword">if</span> (onChange) &#123;</span><br><span class="line">            onChange([]);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (&lt;span&gt;</span><br><span class="line">      &#123;(this.state.options.length &gt; 0 &amp;&amp; &lt;Cascader</span><br><span class="line">            defaultValue=&#123;this.state.default_value&#125;</span><br><span class="line">            onChange=&#123;onChange&#125;</span><br><span class="line">            options=&#123;this.state.options&#125;</span><br><span class="line">            loadData=&#123;loadData&#125;</span><br><span class="line">            changeOnSelect</span><br><span class="line">          /&gt;)&#125;</span><br><span class="line">    &lt;/span&gt;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  Geography</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>可复用的model<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> modelExtend <span class="keyword">from</span> <span class="string">'dva-model-extend'</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> share <span class="keyword">from</span> <span class="string">'../services/share'</span></span><br><span class="line"><span class="keyword">import</span> &#123;model&#125; <span class="keyword">from</span> <span class="string">'./common'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> geographyModel = modelExtend(model, &#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    provinces: [],</span><br><span class="line">    citys: [],</span><br><span class="line">    areas: [],</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  effects: &#123;</span><br><span class="line">    * provinces(&#123;payload&#125;, &#123;call, put&#125;) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123;data&#125; = <span class="keyword">yield</span> call(share.provinces, &#123;&#125;);</span><br><span class="line">      <span class="keyword">yield</span> put(&#123;</span><br><span class="line">        type: <span class="string">'updateState'</span>,</span><br><span class="line">        payload: &#123;</span><br><span class="line">          provinces: data,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    * citys(&#123;payload&#125;, &#123;call, put&#125;) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123;data&#125; = <span class="keyword">yield</span> call(share.citys, payload);</span><br><span class="line">      <span class="keyword">yield</span> put(&#123;</span><br><span class="line">        type: <span class="string">'updateState'</span>,</span><br><span class="line">        payload: &#123;</span><br><span class="line">          citys: data,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    * areas(&#123;payload&#125;, &#123;call, put&#125;) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123;data&#125; = <span class="keyword">yield</span> call(share.areas, payload);</span><br><span class="line">      <span class="keyword">yield</span> put(&#123;</span><br><span class="line">        type: <span class="string">'updateState'</span>,</span><br><span class="line">        payload: &#123;</span><br><span class="line">          areas: data,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    * selectProvince(&#123;payload&#125;, &#123;call, put&#125;) &#123;</span><br><span class="line">      <span class="keyword">yield</span> put(&#123;</span><br><span class="line">        type: <span class="string">'citys'</span>,</span><br><span class="line">        payload: payload[<span class="string">'id'</span>],</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">yield</span> put(&#123;</span><br><span class="line">        type: <span class="string">'updateState'</span>,</span><br><span class="line">        payload: &#123;</span><br><span class="line">          current_province: payload,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    * selectCity(&#123;payload&#125;, &#123;call, put&#125;) &#123;</span><br><span class="line">      <span class="keyword">yield</span> put(&#123;</span><br><span class="line">        type: <span class="string">'areas'</span>,</span><br><span class="line">        payload: payload[<span class="string">'id'</span>],</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">yield</span> put(&#123;</span><br><span class="line">        type: <span class="string">'updateState'</span>,</span><br><span class="line">        payload: &#123;</span><br><span class="line">          current_city: payload,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    * initGeography(&#123;payload&#125;, &#123;call, put&#125;) &#123;</span><br><span class="line">      <span class="keyword">let</span> res = <span class="keyword">yield</span> call(share.provinces, &#123;&#125;);</span><br><span class="line">      <span class="keyword">const</span> provinces = res.data</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 若没有默认值，只get省份列表</span></span><br><span class="line">      <span class="keyword">if</span>(!payload || payload.length != <span class="number">3</span>)&#123;</span><br><span class="line">        <span class="keyword">yield</span> put(&#123;</span><br><span class="line">          type: <span class="string">'updateState'</span>,</span><br><span class="line">          payload: &#123;</span><br><span class="line">            provinces,</span><br><span class="line">            citys: [],</span><br><span class="line">            areas: [],</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> province_id = <span class="built_in">parseInt</span>(payload[<span class="number">0</span>]);</span><br><span class="line">      <span class="keyword">const</span> city_id = <span class="built_in">parseInt</span>(payload[<span class="number">1</span>])</span><br><span class="line">      <span class="keyword">const</span> area_id = <span class="built_in">parseInt</span>(payload[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 默认省份是否匹配</span></span><br><span class="line">      <span class="keyword">let</span> current_province = <span class="literal">null</span>;</span><br><span class="line">      provinces.find(<span class="function"><span class="keyword">function</span>(<span class="params">province</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(province.id == province_id)&#123;</span><br><span class="line">          current_province = province;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">if</span>(!current_province) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 找到匹配的省份，get 市区</span></span><br><span class="line">      res = <span class="keyword">yield</span> call(share.citys, current_province.id);</span><br><span class="line">      <span class="keyword">const</span> citys = res.data</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> current_city = <span class="literal">null</span>;</span><br><span class="line">      citys.find(<span class="function"><span class="keyword">function</span>(<span class="params">city</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(city.id == city_id)&#123;</span><br><span class="line">          current_city = city;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">if</span>(!current_city) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">      res = <span class="keyword">yield</span> call(share.areas, current_city.id);</span><br><span class="line">      <span class="keyword">const</span> areas = res.data</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> current_area = <span class="literal">null</span>;</span><br><span class="line">      areas.find(<span class="function"><span class="keyword">function</span>(<span class="params">area</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(area.id == area_id)&#123;</span><br><span class="line">          current_area = area;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">if</span>(!current_area) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">yield</span> put(&#123;</span><br><span class="line">        type: <span class="string">'updateState'</span>,</span><br><span class="line">        payload: &#123;</span><br><span class="line">          provinces,</span><br><span class="line">          citys,</span><br><span class="line">          areas,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  reducers: &#123;</span><br><span class="line">    clearGeography(state,&#123; payload &#125;) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        provinces: [],</span><br><span class="line">        citys: [],</span><br><span class="line">        areas: [],</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  geographyModel,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>使用</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> geographyProps = &#123;</span><br><span class="line">  provinces: state.provinces,</span><br><span class="line">  citys: state.citys,</span><br><span class="line">  areas: state.areas,</span><br><span class="line">  initGeography(item) &#123;</span><br><span class="line">    dispatch(&#123;</span><br><span class="line">      type: <span class="string">`<span class="subst">$&#123;pageKey&#125;</span>/initGeography`</span>,</span><br><span class="line">      payload: item</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  getCitys(item) &#123;</span><br><span class="line">    dispatch(&#123;</span><br><span class="line">      type: <span class="string">`<span class="subst">$&#123;pageKey&#125;</span>/selectProvince`</span>,</span><br><span class="line">      payload: item</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  getAreas (item) &#123;</span><br><span class="line">    dispatch(&#123;</span><br><span class="line">      type: <span class="string">`<span class="subst">$&#123;pageKey&#125;</span>/selectCity`</span>,</span><br><span class="line">      payload: item</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> modelExtend(geographyModel, &#123;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;FormItem</span><br><span class="line">  label=<span class="string">"位置"</span></span><br><span class="line">  required</span><br><span class="line">  &#123;...formItemLayout&#125;</span><br><span class="line">&gt;</span><br><span class="line">  &#123;getFieldDecorator(<span class="string">'geography'</span>, &#123;</span><br><span class="line">    initialValue: state.editType === <span class="string">'create'</span> ? <span class="string">""</span> : [data.province_code,data.city_code,data.area_code],</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        required: <span class="literal">true</span>,</span><br><span class="line">      &#125;],</span><br><span class="line">  &#125;)(</span><br><span class="line">    &lt;Geography &#123;...geographyProps&#125; /&gt;</span><br><span class="line">  )&#125;</span><br><span class="line">&lt;<span class="regexp">/FormItem&gt;</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="http://blog.kimq.cn/2017/12/02/antd/" data-id="ckdbgbyv6000743po5xr7k99l" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
        <a href="http://blog.kimq.cn/2017/12/02/antd/#disqus_thread" class="article-comment-link">
          <i class="fa fa-comment"></i> Comments
        </a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/antd/">antd</a></li></ul>


    </footer>
  </div>
  
    
<ul id="article-nav" class="nav nav-pills nav-justified">
  
  <li role="presentation">
    <a href="/2017/12/02/gorm/" id="article-nav-older" class="article-nav-link-wrap">
      <i class="fa fa-chevron-left pull-left"></i>
      <span class="article-nav-link-title">gorm一些笔记</span>
    </a>
  </li>
  
  
  <li role="presentation">
    <a href="/2017/12/05/influxdb/" id="article-nav-newer" class="article-nav-link-wrap">
      <span class="article-nav-link-title">telegraf/influxdb/grafana初探</span>
      <i class="fa fa-chevron-right pull-right"></i>
    </a>
  </li>
  
</ul>


  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>



        </div>
        <div class="col-sm-2 col-sm-offset-1 blog-sidebar">
          
  
  <div class="sidebar-module">
    <h4>Categories</h4>
    <ul class="sidebar-module-list"><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/Golang/">Golang</a><span class="sidebar-module-list-count">14</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/Openldap/">Openldap</a><span class="sidebar-module-list-count">3</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/Python/">Python</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/后端/">后端</a><span class="sidebar-module-list-count">11</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/学习笔记/">学习笔记</a><span class="sidebar-module-list-count">5</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/开发环境/">开发环境</a><span class="sidebar-module-list-count">13</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/源码学习/">源码学习</a><span class="sidebar-module-list-count">9</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/环境搭建/">环境搭建</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/运营运维/">运营运维</a><span class="sidebar-module-list-count">10</span><ul class="sidebar-module-list-child"><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/运营运维/代理/">代理</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/categories/运营运维/网站/">网站</a><span class="sidebar-module-list-count">1</span></li></ul></li></ul>
  </div>



  
  <div class="sidebar-module">
    <h4>Tags</h4>
    <ul class="sidebar-module-list"><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/ansible/">ansible</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/antd/">antd</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/cookie/">cookie</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/cors/">cors</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/crsf/">crsf</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/docker/">docker</a><span class="sidebar-module-list-count">3</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/drone/">drone</a><span class="sidebar-module-list-count">5</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/elasticsearch/">elasticsearch</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/flask/">flask</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/git/">git</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/github/">github</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/gitlab/">gitlab</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/golang/">golang</a><span class="sidebar-module-list-count">27</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/gorm/">gorm</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/grpc/">grpc</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/hexo/">hexo</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/influxdb/">influxdb</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/jsonp/">jsonp</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/jsonschema/">jsonschema</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/kibana/">kibana</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/martini/">martini</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/nginx/">nginx</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/ngrok/">ngrok</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/node/">node</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/openldap/">openldap</a><span class="sidebar-module-list-count">3</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/pip/">pip</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/proxy/">proxy</a><span class="sidebar-module-list-count">3</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/python/">python</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/redis/">redis</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/sentry/">sentry</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/sqlalchemy/">sqlalchemy</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/ssh/">ssh</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/sso/">sso</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/tars/">tars</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/tavern/">tavern</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/travis/">travis</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/uml/">uml</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/wcgi/">wcgi</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/xss/">xss</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/一致性hash/">一致性hash</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/持续集成/">持续集成</a><span class="sidebar-module-list-count">6</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/盗链/">盗链</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/签名/">签名</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/tags/证书/">证书</a><span class="sidebar-module-list-count">2</span></li></ul>
  </div>



  
  <div class="sidebar-module">
    <h4>Tag Cloud</h4>
    <p class="tagcloud">
      <a href="/tags/ansible/" style="font-size: 10px;">ansible</a> <a href="/tags/antd/" style="font-size: 10px;">antd</a> <a href="/tags/cookie/" style="font-size: 11.67px;">cookie</a> <a href="/tags/cors/" style="font-size: 10px;">cors</a> <a href="/tags/crsf/" style="font-size: 10px;">crsf</a> <a href="/tags/docker/" style="font-size: 13.33px;">docker</a> <a href="/tags/drone/" style="font-size: 16.67px;">drone</a> <a href="/tags/elasticsearch/" style="font-size: 10px;">elasticsearch</a> <a href="/tags/flask/" style="font-size: 11.67px;">flask</a> <a href="/tags/git/" style="font-size: 11.67px;">git</a> <a href="/tags/github/" style="font-size: 10px;">github</a> <a href="/tags/gitlab/" style="font-size: 11.67px;">gitlab</a> <a href="/tags/golang/" style="font-size: 20px;">golang</a> <a href="/tags/gorm/" style="font-size: 10px;">gorm</a> <a href="/tags/grpc/" style="font-size: 10px;">grpc</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/influxdb/" style="font-size: 10px;">influxdb</a> <a href="/tags/jsonp/" style="font-size: 10px;">jsonp</a> <a href="/tags/jsonschema/" style="font-size: 10px;">jsonschema</a> <a href="/tags/kibana/" style="font-size: 10px;">kibana</a> <a href="/tags/martini/" style="font-size: 10px;">martini</a> <a href="/tags/nginx/" style="font-size: 15px;">nginx</a> <a href="/tags/ngrok/" style="font-size: 11.67px;">ngrok</a> <a href="/tags/node/" style="font-size: 10px;">node</a> <a href="/tags/openldap/" style="font-size: 13.33px;">openldap</a> <a href="/tags/pip/" style="font-size: 10px;">pip</a> <a href="/tags/proxy/" style="font-size: 13.33px;">proxy</a> <a href="/tags/python/" style="font-size: 11.67px;">python</a> <a href="/tags/redis/" style="font-size: 10px;">redis</a> <a href="/tags/sentry/" style="font-size: 11.67px;">sentry</a> <a href="/tags/sqlalchemy/" style="font-size: 10px;">sqlalchemy</a> <a href="/tags/ssh/" style="font-size: 11.67px;">ssh</a> <a href="/tags/sso/" style="font-size: 10px;">sso</a> <a href="/tags/tars/" style="font-size: 10px;">tars</a> <a href="/tags/tavern/" style="font-size: 10px;">tavern</a> <a href="/tags/travis/" style="font-size: 10px;">travis</a> <a href="/tags/uml/" style="font-size: 10px;">uml</a> <a href="/tags/wcgi/" style="font-size: 10px;">wcgi</a> <a href="/tags/xss/" style="font-size: 10px;">xss</a> <a href="/tags/一致性hash/" style="font-size: 10px;">一致性hash</a> <a href="/tags/持续集成/" style="font-size: 18.33px;">持续集成</a> <a href="/tags/盗链/" style="font-size: 10px;">盗链</a> <a href="/tags/签名/" style="font-size: 11.67px;">签名</a> <a href="/tags/证书/" style="font-size: 11.67px;">证书</a>
    </p>
  </div>


  
  <div class="sidebar-module">
    <h4>Archives</h4>
    <ul class="sidebar-module-list"><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2020/08/">八月 2020</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2020/06/">六月 2020</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2020/03/">三月 2020</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2020/02/">二月 2020</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2020/01/">一月 2020</a><span class="sidebar-module-list-count">6</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2018/07/">七月 2018</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2018/06/">六月 2018</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2018/05/">五月 2018</a><span class="sidebar-module-list-count">3</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2017/12/">十二月 2017</a><span class="sidebar-module-list-count">5</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2017/10/">十月 2017</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2017/08/">八月 2017</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2017/07/">七月 2017</a><span class="sidebar-module-list-count">8</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2017/06/">六月 2017</a><span class="sidebar-module-list-count">7</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2017/04/">四月 2017</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2017/03/">三月 2017</a><span class="sidebar-module-list-count">10</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2017/02/">二月 2017</a><span class="sidebar-module-list-count">10</span></li></ul>
  </div>



  
  <div class="sidebar-module">
    <h4>Recents</h4>
    <ul class="sidebar-module-list">
      
        <li>
          <a href="/2020/08/01/gitlab-sentry/">gitlab/sentry集成</a>
        </li>
      
        <li>
          <a href="/2020/06/10/ansible/">Ansible实践</a>
        </li>
      
        <li>
          <a href="/2020/03/08/elasticsearch_basic/">ElasticSearch学习笔记</a>
        </li>
      
        <li>
          <a href="/2020/02/29/jaeger_basic/">Jaeger初探</a>
        </li>
      
        <li>
          <a href="/2020/02/20/tavern/">ResfulApi测试框架tavern</a>
        </li>
      
    </ul>
  </div>



        </div>
    </div>
  </div>
  <footer class="blog-footer">
  <div class="container">
    <div id="footer-info" class="inner">
      &copy; 2020 KingQiu<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
      <br/>
      CopyRight © 2019 <a href="http://beian.miit.gov.cn/" target="_blank">粤ICP备19068003号</a>
    </div>
  </div>
</footer>
<script>
(function(){
    var bp = document.createElement('script');
    bp.src = '//push.zhanzhang.baidu.com/push.js';
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

  
<script>
  var disqus_shortname = 'blog-qiujinwu-com';
  
  var disqus_url = 'http://blog.kimq.cn/2017/12/02/antd/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="http://cdn.bootcss.com/jquery/2.1.4/jquery.min.js" crossorigin="anonymous"></script>

<script src="http://cdn.bootcss.com/bootstrap/3.3.6/js/bootstrap.min.js" crossorigin="anonymous"></script>



<script src="/js/script.js"></script>

</body>
</html>
